<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form Submissions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }

        .filter-select {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            background: white;
            min-width: 180px;
        }

        .submissions-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            display: grid;
            grid-template-columns: 1fr 2fr 2fr 3fr 1fr;
            gap: 15px;
            padding: 15px 20px;
            background: #2c3e50;
            color: white;
            font-weight: 600;
        }

        .submission-item {
            display: grid;
            grid-template-columns: 1fr 2fr 2fr 3fr 1fr;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .submission-item:hover {
            background: #f9f9f9;
        }

        .submission-item:last-child {
            border-bottom: none;
        }

        .name {
            font-weight: 600;
            color: #2c3e50;
        }

        .email {
            color: #3498db;
        }

        .subject {
            color: #2c3e50;
        }

        .message {
            color: #7f8c8d;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .date {
            color: #95a5a6;
            font-size: 0.9rem;
            text-align: right;
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            background: none;
            border: none;
            color: #7f8c8d;
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.3s;
        }

        .action-btn:hover {
            color: #3498db;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .message-content {
            line-height: 1.6;
            color: #2c3e50;
        }

        .message-meta {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {

            .table-header,
            .submission-item {
                grid-template-columns: 1fr 1fr;
                grid-template-areas:
                    "name date"
                    "email email"
                    "subject actions";
                gap: 10px;
            }

            .name {
                grid-area: name;
            }

            .email {
                grid-area: email;
            }

            .subject {
                grid-area: subject;
            }

            .date {
                grid-area: date;
                text-align: left;
            }

            .actions {
                grid-area: actions;
                justify-content: flex-end;
            }

            .message {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
            }

            .search-box,
            .filter-select {
                min-width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Contact Form Submissions</h1>
            <p class="subtitle">View and manage all contact form inquiries</p>
        </header>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="total-submissions">0</div>
                <div class="stat-label">Total Submissions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="today-submissions">0</div>
                <div class="stat-label">Today's Submissions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unread-submissions">0</div>
                <div class="stat-label">Unread Messages</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="responded-submissions">0</div>
                <div class="stat-label">Responded To</div>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search submissions...">
            </div>
            <select class="filter-select" id="status-filter">
                <option value="all">All Statuses</option>
                <option value="unread">Unread</option>
                <option value="read">Read</option>
                <option value="responded">Responded</option>
            </select>
            <select class="filter-select" id="date-filter">
                <option value="all">All Dates</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
            </select>
        </div>

        <div class="submissions-container">
            <div class="table-header">
                <div>Name</div>
                <div>Email</div>
                <div>Subject</div>
                <div>Message</div>
            </div>

            <div id="submissions-list">
                <!-- Submission items will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Modal for viewing full message -->
    <div class="modal" id="message-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-subject">Message Subject</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="message-content" id="modal-message">
                <!-- Full message content will go here -->
            </div>
            <div class="message-meta" id="modal-meta">
                <!-- Sender info will go here -->
            </div>
        </div>
    </div>

    <script>
        // Use your CSV export URL here
        const CSV_URL = "https://docs.google.com/spreadsheets/d/1Vo5MWlq3abBSgi_S7C1eXDCmaaCecGJjPPYjA8WY2ns/export?format=csv&gid=0";

        const submissionsList = document.getElementById('submissions-list');
        const searchInput = document.getElementById('search-input');
        const statusFilter = document.getElementById('status-filter');
        const dateFilter = document.getElementById('date-filter');
        const messageModal = document.getElementById('message-modal');
        const closeModal = document.getElementById('close-modal');
        const modalSubject = document.getElementById('modal-subject');
        const modalMessage = document.getElementById('modal-message');
        const modalMeta = document.getElementById('modal-meta');

        let submissions = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadFromCSV();
            searchInput.addEventListener('input', filterSubmissions);
            statusFilter.addEventListener('change', filterSubmissions);
            dateFilter.addEventListener('change', filterSubmissions);
            closeModal.addEventListener('click', () => messageModal.style.display = 'none');
            window.addEventListener('click', e => {
                if (e.target === messageModal) messageModal.style.display = 'none';
            });

            setInterval(loadFromCSV, 30000); // refresh every 30s
        });

        async function loadFromCSV() {
            try {
                const res = await fetch(CSV_URL);
                const text = await res.text();
                parseCSV(text);
            } catch (err) {
                console.error("Error loading CSV:", err);
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) {
                submissions = [];
                renderSubmissions([]);
                updateStats();
                return;
            }

            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            submissions = lines.slice(1).map((line, idx) => {
                const cols = line.split(',');
                const obj = {};
                headers.forEach((h, j) => {
                    obj[h] = cols[j] || "";
                });

                return {
                    id: idx + 1,
                    name: obj.name || "",
                    email: obj.email || "",
                    subject: obj.subject || "",
                    message: obj.message || "",
                    date: obj.date || "",
                    status: (obj.status || "").toLowerCase() || 'unread'
                };
            });

            filterSubmissions();
            updateStats();
        }

        function renderSubmissions(arr) {
            submissionsList.innerHTML = "";
            if (arr.length === 0) {
                submissionsList.innerHTML = `
                <div class="empty-state">
                    <i class="far fa-folder-open"></i>
                    <h3>No submissions found</h3>
                    <p>Try adjusting your search or filters</p>
                </div>`;
                return;
            }

            arr.forEach(sub => {
                const node = document.createElement('div');
                node.className = "submission-item";
                node.innerHTML = `
                <div class="name">${sub.name}</div>
                <div class="email">${sub.email}</div>
                <div class="subject">${sub.subject}</div>
                <div class="message">${sub.message}</div>
                <div class="date">${formatDate(sub.date)}</div>
                <div class="actions">
                    <button class="action-btn view-btn" data-id="${sub.id}" title="View Message">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>`;
                submissionsList.appendChild(node);
            });

            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', viewMessage);
            });
        }

        function filterSubmissions() {
            const term = (searchInput.value || "").toLowerCase();
            const status = statusFilter.value;
            const dateF = dateFilter.value;

            const filtered = submissions.filter(s => {
                const matchSearch =
                    s.name.toLowerCase().includes(term) ||
                    s.email.toLowerCase().includes(term) ||
                    s.subject.toLowerCase().includes(term) ||
                    s.message.toLowerCase().includes(term);

                const matchStatus = (status === "all") || (s.status === status);

                let matchDate = true;
                if (dateF !== "all") {
                    const d = new Date(s.date);
                    const today = new Date();
                    if (dateF === "today") {
                        matchDate = d.toDateString() === today.toDateString();
                    } else if (dateF === "week") {
                        const weekAgo = new Date(today);
                        weekAgo.setDate(today.getDate() - 7);
                        matchDate = d >= weekAgo;
                    } else if (dateF === "month") {
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(today.getMonth() - 1);
                        matchDate = d >= monthAgo;
                    }
                }

                return matchSearch && matchStatus && matchDate;
            });

            renderSubmissions(filtered);
        }

        function viewMessage(evt) {
            const id = parseInt(evt.currentTarget.getAttribute('data-id'));
            const sub = submissions.find(s => s.id === id);
            if (!sub) return;

            modalSubject.textContent = sub.subject;
            modalMessage.textContent = sub.message;
            modalMeta.innerHTML = `
            From: <strong>${sub.name}</strong> (${sub.email})<br>
            Date: ${formatDate(sub.date)}<br>
            Status: <span class="status-${sub.status}">${sub.status}</span>`;
            messageModal.style.display = 'flex';
        }

        function updateStats() {
            document.getElementById('total-submissions').textContent = submissions.length;
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('today-submissions').textContent =
                submissions.filter(s => s.date === today).length;
            document.getElementById('unread-submissions').textContent =
                submissions.filter(s => s.status === "unread").length;
            document.getElementById('responded-submissions').textContent =
                submissions.filter(s => s.status === "responded").length;
        }

        function formatDate(ds) {
            const d = new Date(ds);
            if (isNaN(d)) return ds;
            return d.toLocaleDateString(undefined, {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
    </script>

</body>

</html>